# Contributing

## Setup
After [installing forge](https://getfoundry.sh/introduction/installation/),
```sh
git clone git@github.com:FilOzone/filecoin-services.git
cd filecoin-services/service_contracts
make
```

### Setup git hooks
To add a hook to run `forge fmt --check` on `git commit`:
```sh
cd $(git rev-parse --show-toplevel)
echo 'forge fmt --root $(git rev-parse --show-toplevel)/service_contracts --check || exit 1' > .git/hooks/pre-commit
chmod +x .git/hooks/pre-commit
```

## Building

```sh
forge build
```

## Testing
```sh
forge test
```

## Developing `view` methods for `extsload`

Use `extsload` and `extsloadStruct` to make data `public`.

New `view` methods should be added to `FilecoinWarmStorageServiceStateLibrary`.

`FilecoinWarmStorageServiceStateInternalLibrary` and `FilecoinWarmStorageServiceStateView` are autogenerated from `FilecoinWarmStorageServiceStateLibrary` with `make`:
```sh
forge build
make src/lib/FilecoinWarmStorageServiceStateInternalLibrary.sol
make src/FilecoinWarmStorageServiceStateView.sol
```

### Updating `FilecoinWarmStorageServiceLayout`
If you update the storage layout of FilecoinWarmStorageService you should regenerate the storage layout solidity file.
```sh
forge build
make src/lib/FilecoinWarmStorageServiceLayout.sol
```

### Deploy a new `FilecoinWarmStorageServiceStateView`
```sh
make src/FilecoinWarmStorageServiceStateView.sol
tools/generate_view_contract.sh
```
